# Конфигурация для извлечения сущностей из сценариев
# Определяет типы сущностей и пресеты для анализа

# Типы извлекаемых сущностей
entity_types:
  location:
    description: "Основная локация сцены (например: квартира, улица, офис)"
    type: "string"
    required: true
    
  sublocation:
    description: "Подобъект или уточнение локации (например: кухня, спальня)"
    type: "string"
    required: false
    
  time_of_day:
    description: "Время суток (ДЕНЬ, НОЧЬ, УТРО, ВЕЧЕР, РАССВЕТ, ЗАКАТ)"
    type: "string"
    required: true
    
  scene_type:
    description: "Тип сцены (ИНТ, ЭКСТ, НАТ)"
    type: "string"
    required: true
    
  characters:
    description: "Список персонажей, участвующих в сцене"
    type: "list"
    required: true
    
  props:
    description: "Реквизит, необходимый для сцены"
    type: "list"
    required: false
    
  vehicles:
    description: "Игровой транспорт в сцене"
    type: "list"
    required: false
    
  crowd:
    description: "Описание массовки: кто именно присутствует в сцене как фон (например: 'толпа прохожих', 'студенты в аудитории', 'официанты в ресторане'). Если массовки нет, верни пустую строку."
    type: "string"
    required: false
    
  crowd_count:
    description: "Точное количество людей в массовке (только число, без текста). Например, если в тексте 'толпа из 20 человек' или 'массовка: 15 человек', верни 20 или 15 соответственно. Если количество не указано явно, верни 0."
    type: "integer"
    required: false
    
  vfx:
    description: "Визуальные эффекты (спецэффекты)"
    type: "list"
    required: false
    
  sfx:
    description: "Звуковые эффекты"
    type: "list"
    required: false
    
  costumes:
    description: "Описание костюмов персонажей в сцене. Указывай конкретные детали: например, 'деловой костюм', 'спортивная одежда', 'вечернее платье', 'форма полицейского'. Если костюмы не упомянуты или стандартные, верни пустой список."
    type: "list"
    required: false
    
  makeup:
    description: "Требования к гриму и макияжу персонажей (например: 'старение', 'шрамы', 'кровь', 'бледность'). Если грим не упомянут, верни пустой список."
    type: "list"
    required: false
    
  stunts:
    description: "Наличие трюков/каскадеров (true/false)"
    type: "boolean"
    required: false
    
  pyrotechnics:
    description: "Наличие пиротехники (true/false)"
    type: "boolean"
    required: false
    
  special_equipment:
    description: "Специальное техническое оборудование для съемки: камеры на кранах, дроны, стабилизаторы, специальные осветительные приборы, микрофоны на журавлях, операторские тележки и т.д. НЕ включай обычный реквизит, костюмы или грим. Только профессиональное съемочное оборудование. Если такого оборудования нет, верни пустой список."
    type: "list"
    required: false
    
  synopsis:
    description: "Краткое описание сцены"
    type: "string"
    required: false
    
  notes:
    description: "Дополнительные примечания к сцене"
    type: "string"
    required: false

# Пресеты - предопределенные наборы сущностей
presets:
  basic:
    name: "Базовый"
    description: "Минимальный набор полей для КПП"
    entities:
      - location
      - sublocation
      - time_of_day
      - scene_type
      - characters
      - synopsis
      
  extended:
    name: "Расширенный"
    description: "Расширенный набор с реквизитом и эффектами"
    entities:
      - location
      - sublocation
      - time_of_day
      - scene_type
      - characters
      - props
      - vehicles
      - crowd
      - crowd_count
      - vfx
      - synopsis
      
  full:
    name: "Полный"
    description: "Полный набор всех доступных сущностей"
    entities:
      - location
      - sublocation
      - time_of_day
      - scene_type
      - characters
      - props
      - vehicles
      - crowd
      - crowd_count
      - vfx
      - sfx
      - costumes
      - makeup
      - stunts
      - pyrotechnics
      - special_equipment
      - synopsis
      - notes

# Настройки LLM
llm:
  # Используемая модель (путь к локальной модели или имя из HuggingFace)
  # Для GPU 80GB можно использовать более мощные модели:
  # - "mistralai/Mixtral-8x7B-Instruct-v0.1" (отличное качество, доступна, ~47GB) - РЕКОМЕНДУЕТСЯ
  # - "Qwen/Qwen2.5-72B-Instruct" (если доступна, ~40GB)
  # - "mistralai/Mistral-7B-Instruct-v0.2" (быстрее, но меньше качество, ~14GB)
  # - "meta-llama/Llama-3-70B-Instruct" (требует специальный доступ)
  model_name: "Qwen/Qwen2.5-72B-Instruct"
  
  # Альтернативно можно использовать vllm для оптимизации
  use_vllm: false
  
  # Устройство для инференса
  device: "cuda"  # "cuda" или "cpu"
  
  # Параметры генерации
  generation:
    max_new_tokens: 1024  # Уменьшено для Mixtral-8x7B из-за ограничений памяти
    temperature: 0.01  # Снижено для большей точности
    top_p: 0.9
    top_k: 40
    do_sample: true
    
  # Батчевая обработка
  batch:
    scene_detection_batch_size: 10
    entity_extraction_batch_size: 1  # Уменьшено из-за ограничений памяти Mixtral-8x7B
    
  # Использование flash attention (если доступно)
  use_flash_attention: true

# Настройки парсинга
parsing:
  min_scene_length: 50
  max_scene_length: 5000
  scene_detection_confidence_threshold: 0.7

